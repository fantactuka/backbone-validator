!function(a){"function"==typeof define&&define.amd?define(["backbone","underscore"],a):"object"==typeof exports?module.exports=a(require("backbone"),require("underscore")):a(window.Backbone,window._)}(function(a,b){"use strict";function c(a){var c=b.inject(a,function(a,c,d){return c.length&&(a[d]=b.isString(c)?[c]:c),a},{});return b.size(c)?c:null}var d=a.Validator={version:"0.3.4",validate:function(a,c,d){var e={};return b.each(a,function(f,g){var h=c[g];if(h){var i=this._validateAll(h,g,f,d,a);i.length&&(e[g]=b.uniq(i))}},this),b.size(e)?e:null},_validateAll:function(a,c,e,f,g){return f=f||this,b.inject(b.flatten([a||[]]),function(a,h){return b.chain(h).omit("message").each(function(i,j){var k=this._validators[j];if(!k)throw new Error("Missed validator: "+j);var l=k.fn.apply(f,[e,i,g]);if(l!==!0){var m=h.message||l||d.createMessage(c,e,i,j,f)||k.message||"Invalid";b.isFunction(m)&&(m=m.apply(f,[c,e,i,j])),m=d.formatMessage(m,c,e,i,j,f),a.push(m)}},this).value(),a},[],this)},add:function(a,b,c){this._validators[a]={fn:b,message:c}},_validators:{},getAttrsToValidate:function(a,c){var d,f,g=a.attributes;return b.isArray(c)||b.isString(c)?d=e(g,c):c?d=c:(f=b.extend({},g,b.result(a,"validation")||{}),d=e(g,b.keys(f))),d},createMessage:function(){return!1},formatMessage:function(a){return a}};d.Extensions={View:{bindValidation:function(a,c){if(!(a=a||this.model))throw"Model is not provided";this.listenTo(a,"validated",function(a,e,f){var g=b.extend({},d.ViewCallbacks,b.pick(this,"onInvalidField","onValidField"),c);f=f||{},b.each(e,function(b,c){var d=f[c];d&&d.length?g.onInvalidField.call(this,c,b,d,a):g.onValidField.call(this,c,b,a)},this)})}},Model:{validate:function(a,c){var e=b.result(this,"validation")||{},f=d.getAttrsToValidate(this,a),g=d.validate(f,e,this);return c=c||{},g=c.processErrors?c.processErrors(g):d.ModelCallbacks.processErrors(g),c.silent||b.defer(b.bind(this.triggerValidated,this),f,g),c&&c.suppress?null:g},_validate:function(a,c){if(!c.validate||!this.validate)return!0;var e=d.getAttrsToValidate(this,a),f=this.validationError=this.validate(e,c)||null;return f&&this.trigger("invalid",this,f,b.extend(c||{},{validationError:f})),!f},triggerValidated:function(a,b){var e=d.getAttrsToValidate(this,a),f=c(b);this.validationError=f,this.trigger("validated",this,e,f),this.trigger("validated:"+(f?"invalid":"valid"),this,e,f)},isValid:function(a,b){var c=d.getAttrsToValidate(this,a);return!this.validate||!this.validate(c,b)}}};var e=function(a,c){return b.inject(b.flatten([c]),function(b,c){return b[c]=a[c],b},{})};d.ViewCallbacks={onValidField:function(a){var b=this.$('input[name="'+a+'"]');b.removeClass("error"),b.next(".error-text").remove()},onInvalidField:function(a,b,c){var d=this.$('input[name="'+a+'"]');d.next(".error-text").remove(),d.addClass("error").after('<div class="error-text">'+c.join(", ")+"</div>")}},d.ModelCallbacks={processErrors:function(a){return a}};var f=[{name:"required",message:"Is required",fn:function(a,b){return b===!1||!!a}},{name:"blank",message:"Could not be blank",fn:function(a,c){return c===!0||(b.isString(a)?!a.match(/^[\s\t\r\n]*$/):b.isArray(a)?!!a.length:b.isObject(a)?!b.isEmpty(a):!!a)}},{name:"collection",fn:function(a,c){if(c===!1||!a)return!0;"function"==typeof c&&(a=c.call(this,a));var d=b.inject(a.models||a,function(a,b,c){var d=b.validate();return d&&a.push([c,d]),a},[]);return!d.length||d}},{name:"model",fn:function(a,b){return b===!1||!a||("function"==typeof b&&(a=b.call(this,a)),a.validate()||!0)}},{name:"minLength",message:"Is too short",fn:function(a,b){return!a||a.length>=b}},{name:"maxLength",message:"Is too long",fn:function(a,b){return!a||a.length<=b}},{name:"format",message:"Does not match format",fn:function(a,b){return!a||!!a.toString().match(d.formats[b]||b)}},{name:"fn",fn:function(a,b,c){return b.call(this,a,c)}}];return d.formats={digits:/^\d+$/,number:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i},b.each(f,function(a){d.add(a.name,a.fn,a.message)}),b.extend(a.Model.prototype,d.Extensions.Model),b.extend(a.View.prototype,d.Extensions.View),d});